!function(a){var b=a.getElementsByTagName("head")[0],c=a.createElement("link");c.href="http://static.tcy365.com/common/ui/jdpicker/1.0/jdpicker.css",c.rel="stylesheet",b.insertBefore(c,b.firstChild)}(document),jdPicker=function($){function jdPicker(a,b){"object"!=typeof b&&(b={}),this.input=$(a),$.extend(this,jdPicker.DEFAULT_OPTS,b),1==this.timeShow&&(this.timeBtn=1),this.bindMethodsToObj("show","hide","hideIfClickOutside","keydownHandler","selectDate"),this.build(),this.hide()}return jdPicker.DEFAULT_OPTS={month_names:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],short_month_names:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],short_month_names2:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],short_day_names:["日","一","二","三","四","五","六"],error_out_of_range:"选择的日期不符合规则",selectable_days:[0,1,2,3,4,5,6],non_selectable:[],rec_non_selectable:[],start_of_week:1,show_week:0,select_week:0,week_label:"周",date_min:"",date_max:"",date_format:"YYYY/mm/dd",time_format:"hh:mm:ss",timeShow:0,timeBtn:1,change:null},jdPicker.prototype={setDateMin:function(date){var matches;""!=date&&date.match(this.reg)?(matches=date.match(this.reg),this.date_min=eval(this.date_decode)):this.date_min=""},setDateMax:function(date){var matches;""!=date&&date.match(this.reg)?(matches=date.match(this.reg),this.date_max=eval(this.date_decode)):this.date_max=""},setDateValue:function(a){this.input.val(a)},reBuild:function(){this.moveMonthBy(1),this.moveMonthBy(-1)},build:function(a){var c,d,e,f,g,h;switch(a||(this.wrapp=this.input.wrap('<div class="jdpicker_w">')),this.date_format){case"dd/mm/YYYY":this.reg=new RegExp(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/),this.date_decode="new Date(matches[3], parseInt(matches[2]-1), matches[1]);",this.date_encode='this.strpad(date.getDate()) + "/" + this.strpad(date.getMonth()+1) + "/" + date.getFullYear();',this.date_encode_s='this.strpad(date.getDate()) + "/" + this.strpad(date.getMonth()+1)';break;case"FF dd YYYY":this.reg=new RegExp(/^([a-zA-Z]+) (\d{1,2}) (\d{4})$/),this.date_decode="new Date(matches[3], this.indexFor(this.month_names, matches[1]), matches[2]);",this.date_encode='this.month_names[date.getMonth()] + " " + this.strpad(date.getDate()) + " " + date.getFullYear();',this.date_encode_s='this.month_names[date.getMonth()] + " " + this.strpad(date.getDate());';break;case"dd MM YYYY":this.reg=new RegExp(/^(\d{1,2}) ([a-zA-Z]{3}) (\d{4})$/),this.date_decode="new Date(matches[3], this.indexFor(this.short_month_names, matches[2]), matches[1]);",this.date_encode='this.strpad(date.getDate()) + " " + this.short_month_names[date.getMonth()] + " " + date.getFullYear();',this.date_encode_s='this.strpad(date.getDate()) + " " + this.short_month_names[date.getMonth()];';break;case"MM dd YYYY":this.reg=new RegExp(/^([\u4E00-\uFA29]{2,4}) (\d{1,2}) (\d{4})$/),this.date_decode="new Date(matches[3], this.indexFor(this.short_month_names, matches[1]), matches[2]);",this.date_encode='this.short_month_names[date.getMonth()] + " " + this.strpad(date.getDate()) + " " + date.getFullYear();',this.date_encode_s='this.short_month_names[date.getMonth()] + " " + this.strpad(date.getDate());';break;case"dd FF YYYY":this.reg=new RegExp(/^(\d{1,2}) ([a-zA-Z]+) (\d{4})$/),this.date_decode="new Date(matches[3], this.indexFor(this.month_names, matches[2]), matches[1]);",this.date_encode='this.strpad(date.getDate()) + " " + this.month_names[date.getMonth()] + " " + date.getFullYear();',this.date_encode_s='this.strpad(date.getDate()) + " " + this.month_names[date.getMonth()];';break;case"YYYY-mm-dd":this.reg=new RegExp(/^(\d{4})\-(\d{1,2})\-(\d{1,2})$/),this.date_decode="new Date(matches[1], parseInt(matches[2]-1), matches[3]);",this.date_encode='date.getFullYear() + "-" + this.strpad(date.getMonth()+1) + "-" + this.strpad(date.getDate());',this.date_encode_s='this.strpad(date.getMonth()+1) + "-" + this.strpad(date.getDate());';break;case"YYYY/mm/dd":default:this.reg=new RegExp(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/),this.date_decode="new Date(matches[1], parseInt(matches[2]-1), matches[3]);",this.date_encode='date.getFullYear() + "/" + this.strpad(date.getMonth()+1) + "/" + this.strpad(date.getDate());',this.date_encode_s='this.strpad(date.getMonth()+1) + "/" + this.strpad(date.getDate());'}this.setDateMax(this.date_max),this.setDateMin(this.date_min),c=$('<p class="month_nav"><span class="button prev" title="[Page-Up]">&#171;</span> <span class="month_name"></span> <span class="button next" title="[Page-Down]">&#187;</span></p>'),this.monthNameSpan=$(".month_name",c),$(".prev",c).click(this.bindToObj(function(){this.moveMonthBy(-1)})),$(".next",c).click(this.bindToObj(function(){this.moveMonthBy(1)})),this.monthNameSpan.click(this.bindToObj(function(){$("select",this.monthNameSpan).length>0||(this.monthNameSpan.empty().append(this.getMonthSelect()),$("select",this.monthNameSpan).change(this.bindToObj(function(){this.moveMonthBy(parseInt($("select :selected",this.monthNameSpan).val())-this.currentMonth.getMonth())})))})),d=$('<p class="year_nav"><span class="button prev" title="[Ctrl+Page-Up]">&#171;</span> <span class="year_name" id="year_name"></span> <span class="button next" title="[Ctrl+Page-Down]">&#187;</span></p>'),this.yearNameSpan=$(".year_name",d),$(".prev",d).click(this.bindToObj(function(){this.moveMonthBy(-12)})),$(".next",d).click(this.bindToObj(function(){this.moveMonthBy(12)})),this.yearNameSpan.click(this.bindToObj(function(){var a,b;0==$(".year_name input",this.rootLayers).length&&(a=this.yearNameSpan.html(),b=$('<input type="text" class="text year_input" value="'+a+'" />'),this.yearNameSpan.empty().append(b),$(".year_input",d).keyup(this.bindToObj(function(){4==$("input",this.yearNameSpan).val().length&&$("input",this.yearNameSpan).val()!=a&&parseInt($("input",this.yearNameSpan).val())==$("input",this.yearNameSpan).val()?this.moveMonthBy(parseInt(12*parseInt(parseInt($("input",this.yearNameSpan).val())-a))):$("input",this.yearNameSpan).val().length>4&&$("input",this.yearNameSpan).val($("input",this.yearNameSpan).val().substr(0,4))})),$("input",this.yearNameSpan).focus(),$("input",this.yearNameSpan).select())})),e=$('<div class="error_msg"></div>'),f=$('<div class="nav"></div>').append(e,c,d),g="<table><thead><tr>",1==this.show_week&&(g+='<th class="week_label">'+this.week_label+"</th>"),$(this.adjustDays(this.short_day_names)).each(function(){g+="<th>"+this+"</th>"}),g+="</tr></thead><tbody></tbody></table>",1===this.timeShow&&0==this.select_week&&(g+=this.timeHourTemp()),1===this.timeBtn&&0==this.select_week&&(g+='<div class="curr_time"><button class="data_ui_btn data_ui_btn_now" type="button">现在时间</button><button class="data_ui_btn data_ui_btn_clear" type="button">清空</button><button class="data_ui_btn data_ui_btn_close" type="button">关闭</button></div>'),h="hidden"==this.input.context.type?' style="display:block; position:static; margin:0 auto"':"",this.dateSelector=this.rootLayers=$('<div class="date_selector" '+h+"></div>").append(f,g).insertAfter(this.input),1===this.timeBtn&&this.timeBtnBind(this.dateSelector),$.browser.msie&&$.browser.version<7&&(this.ieframe=$('<iframe class="date_selector_ieframe" frameborder="0" src="#"></iframe>').insertBefore(this.dateSelector),this.rootLayers=this.rootLayers.add(this.ieframe),$(".button",f).mouseover(function(){$(this).addClass("hover")}),$(".button",f).mouseout(function(){$(this).removeClass("hover")})),1===this.timeShow&&0==this.select_week&&(this.timeHourBind(this.dateSelector),this.timeHour(1)),this.tbody=$("tbody",this.dateSelector),this.input.change(this.bindToObj(function(){this.selectDate()})),this.input.click(this.bindToObj(function(){this.selectDate()})),this.selectDate()},timeBtnBind:function(a){var b=this;$(".data_ui_btn_now",a).click(function(){b.changeInput(b.dateToString(new Date),1)}),$(".data_ui_btn_clear",a).click(function(){b.input.val(""),b.hide()}),$(".data_ui_btn_close",a).click(function(){b.hide()})},timeHourTemp:function(){var d,e,f,a="",b="",c="";for(d=0;24>d;d++)e=d>9?d:"0"+d,a+="<span date='"+e+"'>"+e+"</span>";for(d=0;60>d;d++)e=d>9?d:"0"+d,b+="<span date='"+e+"'>"+e+"</span>";for(d=0;60>d;d++)e=d>9?d:"0"+d,c+="<span date='"+e+"'>"+e+"</span>";return f='<div class="data_time_hour time_item"><span>00</span> 时</div><div class="data_time_minute time_item"><span>00</span> 分</div>',"hh:mm:ss"==this.time_format&&(f+='<div class="data_time_second time_item"><span>00</span> 秒</div>'),f='<div class="date_time"><div class="til">时间：</div>'+f+'<div class="select_item select_item_hour none">'+a+'</div><div class="select_item select_item_mintue none">'+b+'</div><div class="select_item select_item_second none">'+c+"</div></div>"},timeHourBind:function(a){var b=$(".data_time_hour span",a),c=$(".data_time_minute span",a),d=$(".data_time_second span",a),e=$(".select_item_hour",a),f=$(".select_item_mintue",a),g=$(".select_item_second",a),h=this,i=function(){$(".time_item span",a).removeClass("on"),e.hide(),f.hide(),g.hide()},j=function(a,b){var c=a.html();i(),a.addClass("on"),b.find("span").removeClass("selected"),b.find("span").each(function(){$(this).html()==c&&$(this).addClass("selected")}),b.show()};b.click(function(){j($(this),e)}),c.click(function(){j($(this),f)}),d.click(function(){j($(this),g)}),$(".select_item_hour span",a).click(function(){b.html($(this).html()),h.changeInput(),i()}),$(".select_item_mintue span",a).click(function(){c.html($(this).html()),h.changeInput(),i()}),$(".select_item_second span",a).click(function(){d.html($(this).html()),h.changeInput(),i()})},selectMonth:function(a){var c,d,e,f,g,h,i,b=new Date(a.getFullYear(),a.getMonth(),a.getDate());if(this.isNewDateAllowed(b)){if(!this.currentMonth||this.currentMonth.getFullYear()!=b.getFullYear()||this.currentMonth.getMonth()!=b.getMonth()){for(this.currentMonth=b,c=this.rangeStart(a),d=this.rangeEnd(a),e=this.daysBetween(c,d),f="",g=0;e>=g;g++)h=new Date(c.getFullYear(),c.getMonth(),c.getDate()+g,12,0),this.isFirstDayOfWeek(h)&&(i=h,new Date(h.getFullYear(),h.getMonth(),h.getDate()+6,12,0),f+=this.select_week&&this.isNewDateAllowed(i)?"<tr date='"+this.dateToString(h)+"' class='selectable_week'>":"<tr>",1==this.show_week&&(f+='<td class="week_num">'+this.getWeekNum(h)+"</td>")),f+=0==this.select_week&&h.getMonth()==a.getMonth()&&this.isNewDateAllowed(h)&&!this.isHoliday(h)||1==this.select_week&&h.getMonth()==a.getMonth()&&this.isNewDateAllowed(i)?'<td class="selectable_day" date="'+this.dateToString(h)+'">'+h.getDate()+"</td>":1!=this.select_week?h.getMonth()==a.getMonth()?'<td class="unselected_month" date="'+this.dateToString(h)+'">'+h.getDate()+"</td>":'<td class="unselected_month"></td>':'<td class="unselected_month" date="'+this.dateToString(h)+'">'+h.getDate()+"</td>",this.isLastDayOfWeek(h)&&(f+="</tr>");this.tbody.empty().append(f),this.monthNameSpan.empty().append(this.monthName(a)),this.yearNameSpan.empty().append(this.currentMonth.getFullYear()),0==this.select_week?$(".selectable_day",this.tbody).click(this.bindToObj(function(a){this.changeInput($(a.target).attr("date"))})):$(".selectable_week",this.tbody).click(this.bindToObj(function(a){this.changeInput($(a.target.parentNode).attr("date"))})),$("td[date='"+this.dateToString(new Date)+"']",this.tbody).addClass("today"),1==this.select_week?($("tr",this.tbody).mouseover(function(){$(this).addClass("hover")}),$("tr",this.tbody).mouseout(function(){$(this).removeClass("hover")})):($("td.selectable_day",this.tbody).mouseover(function(){$(this).addClass("hover")}),$("td.selectable_day",this.tbody).mouseout(function(){$(this).removeClass("hover")}))}$(".selected",this.tbody).removeClass("selected"),$('td[date="'+this.selectedDateString+'"], tr[date="'+this.selectedDateString+'"]',this.tbody).addClass("selected")}else this.show_error(this.error_out_of_range)},selectDate:function(a){var b,c,d,e;"undefined"==typeof a&&this.input.val()&&(a=this.stringToDate(this.input.val().replace(/\s{1}\d{2}:\d{2}[:\d{2}]*/,""))),1===this.timeShow&&(b=this.input.val().match(/\d{2}:\d{2}[:\d{2}]*/),b&&b[0]&&(b=b[0].split(":"),c=b[0],d=b[1],e=b[2],$(".data_time_hour span",this.dateSelector).html(c),$(".data_time_minute span",this.dateSelector).html(d),$(".data_time_second span",this.dateSelector).html(e))),a||(a=new Date),1!=this.select_week||this.isFirstDayOfWeek(a)||(a=new Date(a.getFullYear(),a.getMonth(),a.getDate()-a.getDay()+this.start_of_week,12,0)),this.isNewDateAllowed(a)?(this.selectedDate=a,this.selectedDateString=this.dateToString(this.selectedDate),this.selectMonth(this.selectedDate)):this.date_min&&this.daysBetween(this.date_min,a)<0?(this.selectedDate=this.date_min,this.selectMonth(this.date_min),this.input.val(" ")):(this.selectMonth(this.date_max),this.input.val(" "))},isNewDateAllowed:function(a){return(!this.date_min||this.daysBetween(this.date_min,a)>=0)&&(!this.date_max||this.daysBetween(a,this.date_max)>=0)},isHoliday:function(a){return this.indexFor(this.selectable_days,a.getDay())===!1||this.indexFor(this.non_selectable,this.dateToString(a))!==!1||this.indexFor(this.rec_non_selectable,this.dateToShortString(a))!==!1},timeHour:function(a){var c,d,e,f,g,h,i,j;return c=new Date,d=c.getHours(),e=c.getMinutes(),f=c.getSeconds(),d=d>9?d:"0"+d,e=e>9?e:"0"+e,f=f>9?f:"0"+f,g=this.dateSelector.find(".data_time_hour span").html(),h=this.dateSelector.find(".data_time_minute span").html(),i=this.dateSelector.find(".data_time_second span").html(),"hh:mm:ss"==this.time_format?1===a?(timeTemp=d+":"+e+":"+f,this.time_start&&(j=this.time_start.split(":"),d=j[0],e=j[1],f=j[2]),this.dateSelector.find(".data_time_hour span").html(d),this.dateSelector.find(".data_time_minute span").html(e),this.dateSelector.find(".data_time_second span").html(f)):timeTemp=g+":"+h+":"+i:1===a?(timeTemp=d+":"+e,this.time_start&&(j=this.time_start.split(":"),d=j[0],e=j[1]),this.dateSelector.find(".data_time_hour span").html(d),this.dateSelector.find(".data_time_minute span").html(e)):timeTemp=g+":"+h,timeTemp},changeInput:function(a,b){var d,e=this;if("undefined"==typeof a){if(""==this.input.val())return;1==this.timeShow&&(a=this.input.val().replace(/\s{1}\d{2}:\d{2}[:\d{2}]*/,""))}return d=a,this.isNewDateAllowed(this.stringToDate(a))?(this.timeShow&&(a=1===b?a+" "+this.timeHour(1):a+" "+this.timeHour()),this.input.val(a),this.selectDate(),$(".selected",this.tbody).removeClass("selected"),1==this.select_week?$('tr[date="'+d+'"]',this.tbody).addClass("selected"):$('td[date="'+d+'"]',this.tbody).addClass("selected"),"hidden"==this.input.context.type||1===this.timeShow&&0==this.select_week||this.hide(),$.isFunction(e.change)&&this.change(),void 0):(this.show_error(this.error_out_of_range),void 0)},show:function(){$(".error_msg",this.rootLayers).css("display","none"),0==this.select_week&&1==this.timeShow&&""==this.input.val()&&this.timeHour(1),this.rootLayers.show(),$([window,document.body]).click(this.hideIfClickOutside),this.input.unbind("focus",this.show),this.input.attr("readonly",!0),$(document.body).keydown(this.keydownHandler),this.setPosition()},hide:function(){"hidden"!=this.input.context.type&&(this.input.removeAttr("readonly"),this.rootLayers.hide(),$([window,document.body]).unbind("click",this.hideIfClickOutside),this.input.focus(this.show),$(document.body).unbind("keydown",this.keydownHandler))},hideIfClickOutside:function(a){a.target==this.input[0]||"option"==a.target.nodeName.toLowerCase()||this.insideSelector(a)||this.hide(),"span"==a.target.nodeName.toLowerCase()&&$(a.target).parent().hasClass("select_item")||$(a.target).parent().hasClass("time_item")||($(".date_time .select_item").hide(),$(".date_time .time_item span").removeClass("on"))},insideSelector:function(a){var b=this.dateSelector.offset();return b.right=b.left+this.dateSelector.outerWidth(),b.bottom=b.top+this.dateSelector.outerHeight(),a.pageY<b.bottom&&a.pageY>b.top&&a.pageX<b.right&&a.pageX>b.left},keydownHandler:function(a){switch(a.keyCode){case 9:case 27:return this.hide(),void 0;case 13:this.isNewDateAllowed(this.stringToDate(this.selectedDateString))&&!this.isHoliday(this.stringToDate(this.selectedDateString))&&this.changeInput(this.selectedDateString);break;case 33:this.moveDateMonthBy(a.ctrlKey?-12:-1);break;case 34:this.moveDateMonthBy(a.ctrlKey?12:1);break;case 38:this.moveDateBy(-7);break;case 40:this.moveDateBy(7);break;case 37:0==this.select_week&&this.moveDateBy(-1);break;case 39:0==this.select_week&&this.moveDateBy(1);break;default:return}a.preventDefault()},stringToDate:function(string){var matches;return(matches=string.match(this.reg))?0==matches[3]&&0==matches[2]&&0==matches[1]?null:eval(this.date_decode):null},dateToString:function(date){return eval(this.date_encode)},dateToShortString:function(date){return eval(this.date_encode_s)},setPosition:function(){this.input.offset(),this.rootLayers.css({top:this.input.outerHeight(),left:0}),this.ieframe&&this.ieframe.css({width:this.dateSelector.outerWidth(),height:this.dateSelector.outerHeight()})},moveDateBy:function(a){var b=new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth(),this.selectedDate.getDate()+a);this.selectDate(b)},moveDateMonthBy:function(a){var b=new Date(this.selectedDate.getFullYear(),this.selectedDate.getMonth()+a,this.selectedDate.getDate());b.getMonth()==this.selectedDate.getMonth()+a+1&&b.setDate(0),this.selectDate(b)},moveMonthBy:function(a){var b;b=0>a?new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()+a+1,-1):new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()+a,1),this.selectMonth(b)},monthName:function(a){return this.month_names[a.getMonth()]},getMonthSelect:function(){var b,a="<select>";for(b=0;b<this.month_names.length;b++)a+=b==this.currentMonth.getMonth()?'<option value="'+b+'" selected="selected">'+this.month_names[b]+"</option>":'<option value="'+b+'">'+this.month_names[b]+"</option>";return a+="</select>"},bindToObj:function(a){var b=this;return function(){return a.apply(b,arguments)}},bindMethodsToObj:function(){for(var a=0;a<arguments.length;a++)this[arguments[a]]=this.bindToObj(this[arguments[a]])},indexFor:function(a,b){for(var c=0;c<a.length;c++)if(b==a[c])return c;return!1},monthNum:function(a){return this.indexFor(this.month_names,a)},shortMonthNum:function(a){return this.indexFor(this.short_month_names,a)},shortDayNum:function(a){return this.indexFor(this.short_day_names,a)},daysBetween:function(a,b){return"object"!=typeof a&&(a=this.isNewDateAllowed(this.stringToDate(a))),a=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),b=Date.UTC(b.getFullYear(),b.getMonth(),b.getDate()),(b-a)/864e5},changeDayTo:function(a,b,c){var d=c*(Math.abs(b.getDay()-a-7*c)%7);return new Date(b.getFullYear(),b.getMonth(),b.getDate()+d)},rangeStart:function(a){return this.changeDayTo(this.start_of_week,new Date(a.getFullYear(),a.getMonth()),-1)},rangeEnd:function(a){return this.changeDayTo((this.start_of_week-1)%7,new Date(a.getFullYear(),a.getMonth()+1,0),1)},isFirstDayOfWeek:function(a){return a.getDay()==this.start_of_week},getWeekNum:function(a){var b,c;return date_week=new Date(a.getFullYear(),a.getMonth(),a.getDate()+6),b=new Date(date_week.getFullYear(),0,1,12,0),c=parseInt(this.daysBetween(b,date_week))+1,Math.floor((date_week.getDay()+c+5)/7)-Math.floor(date_week.getDay()/5)},isLastDayOfWeek:function(a){return a.getDay()==(this.start_of_week-1)%7},show_error:function(a){$(".error_msg",this.rootLayers).html(a),$(".error_msg",this.rootLayers).slideDown(400,function(){setTimeout("$('.error_msg', this.rootLayers).slideUp(200);",2e3)})},adjustDays:function(a){var c,b=[];for(c=0;c<a.length;c++)b[c]=a[(c+this.start_of_week)%7];return b},strpad:function(a){return parseInt(a)<10?"0"+parseInt(a):parseInt(a)}},$.fn.jdPicker=function(a){return new jdPicker(this,a)},$.jdPicker={initialize:function(a){$("input.jdpicker").each(function(){$(this).jdPicker(a)})}},jdPicker}(jQuery),$($.jdPicker.initialize);